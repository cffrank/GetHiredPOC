name = "gethiredpoc-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# CORS allowed origins (update with production frontend URL)
[vars]
FRONTEND_URL = "https://gethiredpoc.pages.dev"
BACKEND_URL = "https://gethiredpoc-api.carl-f-frank.workers.dev"
CLOUDFLARE_ACCOUNT_ID = "280c58ea17d9fe3235c33bd0a52a256b"

# Admin emails (comma-separated list)
# Note: Update this with actual admin email addresses
ADMIN_EMAILS = "carl.f.frank@gmail.com,admin@example.com"

# Apify Scraper Configuration (Uses APIFY_API_TOKEN)
APIFY_LINKEDIN_ACTOR_ID = "curious_coder/linkedin-jobs-search-scraper"
APIFY_INDEED_ACTOR_ID = "misceres/indeed-scraper"
APIFY_DICE_ACTOR_ID = "worldunboxer/dice-jobs-scraper"

# Cost Controls
MAX_DAILY_SCRAPER_RUNS = "10"
MAX_USER_IMPORTS_PER_DAY = "1"

# Note: Add APIFY_API_TOKEN via: npx wrangler secret put APIFY_API_TOKEN

# Resend API key for email notifications
# Note: Add RESEND_API_KEY via: npx wrangler secret put RESEND_API_KEY

# LinkedIn OAuth credentials
LINKEDIN_CLIENT_ID = "86gnb581r70q6j"
# Note: Add LINKEDIN_CLIENT_SECRET via: npx wrangler secret put LINKEDIN_CLIENT_SECRET

# Note: OpenAI API key for chat is configured in the AI Gateway dashboard

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "gethiredpoc-db"
database_id = "a927d1e6-cf48-4b67-82f6-472964063676"
migrations_dir = "../../migrations"

# R2 Storage
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "gethiredpoc-storage"

# KV Namespaces
[[kv_namespaces]]
binding = "KV_CACHE"
id = "7ad0fb2965a4468c983557e3535ec772"

[[kv_namespaces]]
binding = "KV_SESSIONS"
id = "e96d7669b11c4f63b2b1ce41026a0c5d"

# Cloudflare Workers AI binding with AI Gateway
[ai]
binding = "AI"
gateway_id = "jobmatch-ai-gateway-dev"

# Vectorize binding for semantic search
[[vectorize]]
binding = "VECTORIZE"
index_name = "job-embeddings"

# Cron triggers
[triggers]
crons = ["0 1 * * *"]  # Daily at 1 AM UTC for Apify scraper imports
