---
phase: 03-security-error-handling
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/components/ErrorBoundary.tsx
  - src/app/components/Toast.tsx
  - src/app/pages/Profile.tsx
  - src/app/pages/Applications.tsx
  - src/app/pages/JobDetail.tsx
  - src/app/Document.tsx
  - packages/frontend/src/components/ErrorBoundary.tsx
  - packages/frontend/src/components/Toast.tsx
  - packages/frontend/src/pages/admin/AdminPrompts.tsx
  - packages/frontend/src/pages/admin/AdminJobs.tsx
  - packages/frontend/src/pages/admin/AdminUsers.tsx
  - packages/frontend/src/pages/Resume.tsx
  - packages/frontend/src/components/WorkExperience.tsx
  - packages/frontend/src/components/Education.tsx
  - packages/frontend/src/main.tsx
autonomous: true
requirements:
  - ERR-03
  - ERR-04

must_haves:
  truths:
    - "When a component in Profile, Applications, or JobDetail crashes, the rest of the page continues to render and the user sees a friendly error message with a Retry button"
    - "All alert() calls in the frontend are replaced with toast notifications"
    - "All confirm() calls are replaced with inline confirmation UI"
    - "Success toasts appear top-right for 3 seconds, error toasts for 5 seconds"
    - "Error toasts include a Retry action button where appropriate"
  artifacts:
    - path: "src/app/components/ErrorBoundary.tsx"
      provides: "Reusable error boundary wrapper for rwsdk app"
      exports: ["ErrorFallback"]
    - path: "src/app/components/Toast.tsx"
      provides: "Toast provider wrapper for rwsdk app"
    - path: "packages/frontend/src/components/ErrorBoundary.tsx"
      provides: "Reusable error boundary wrapper for frontend package"
      exports: ["ErrorFallback"]
    - path: "packages/frontend/src/components/Toast.tsx"
      provides: "Toast provider wrapper for frontend package"
  key_links:
    - from: "src/app/pages/Profile.tsx"
      to: "src/app/components/ErrorBoundary.tsx"
      via: "ErrorBoundary wraps profile content sections"
      pattern: "ErrorBoundary"
    - from: "src/app/pages/Profile.tsx"
      to: "sonner"
      via: "toast.success/toast.error replace alert() calls"
      pattern: "toast\\.(success|error)"
    - from: "src/app/Document.tsx"
      to: "sonner"
      via: "Toaster component rendered in root document"
      pattern: "Toaster"
---

<objective>
Add React error boundaries around major UI sections and replace all alert()/confirm() calls with toast notifications and inline confirmation UI.

Purpose: Close ERR-03 (error boundaries per UI domain) and ERR-04 (user-friendly error notifications). Currently, an unhandled render error blanks the entire page, and all error/success feedback uses blocking browser alert() dialogs.

Output: Per-section error boundaries in Profile, Applications, and JobDetail with friendly fallback UI. Toast notifications (sonner) for all success/error feedback. Inline confirmation UI replacing confirm() dialogs.
</objective>

<execution_context>
@/home/carl/.claude/get-shit-done/workflows/execute-plan.md
@/home/carl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-security-error-handling/03-RESEARCH.md

@src/app/pages/Profile.tsx
@src/app/pages/Applications.tsx
@src/app/pages/JobDetail.tsx
@src/app/Document.tsx
@packages/frontend/src/main.tsx
@packages/frontend/src/pages/admin/AdminPrompts.tsx
@packages/frontend/src/pages/admin/AdminJobs.tsx
@packages/frontend/src/pages/admin/AdminUsers.tsx
@packages/frontend/src/pages/Resume.tsx
@packages/frontend/src/components/WorkExperience.tsx
@packages/frontend/src/components/Education.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install libraries, create ErrorBoundary and Toast components in both apps</name>
  <files>
    src/app/components/ErrorBoundary.tsx
    src/app/components/Toast.tsx
    src/app/Document.tsx
    packages/frontend/src/components/ErrorBoundary.tsx
    packages/frontend/src/components/Toast.tsx
    packages/frontend/src/main.tsx
  </files>
  <action>
**Install dependencies:**
```bash
npm install react-error-boundary sonner
npm install react-error-boundary sonner --workspace=packages/frontend
```

**Create `src/app/components/ErrorBoundary.tsx` (rwsdk app):**

Use react-error-boundary library. Create an `ErrorFallback` component per user decision:
- Simple message + retry button, no illustrations
- Friendly casual tone: "Oops, something went wrong! Let's try that again."
- Console-only error logging (no external reporting)
- Styled with Tailwind: centered text, muted colors, rounded border, padding

```tsx
import { ErrorBoundary } from 'react-error-boundary';
import type { FallbackProps } from 'react-error-boundary';

export function ErrorFallback({ error, resetErrorBoundary }: FallbackProps) {
  console.error('[ErrorBoundary]', error);
  return (
    <div className="p-6 rounded-lg border border-gray-200 text-center">
      <p className="text-gray-600 mb-4">
        Oops, something went wrong! Let&apos;s try that again.
      </p>
      <button
        onClick={resetErrorBoundary}
        className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
      >
        Retry
      </button>
    </div>
  );
}

export { ErrorBoundary };
```

Add `"use client"` directive at the top if required by rwsdk's RSC model (research Open Question 4).

**Create `src/app/components/Toast.tsx` (rwsdk app):**

Wrap sonner's Toaster with the user-specified settings. Add `"use client"` directive for RSC compatibility.

```tsx
"use client";
import { Toaster } from 'sonner';

export function ToastProvider() {
  return <Toaster position="top-right" richColors />;
}

export { toast } from 'sonner';
```

**Update `src/app/Document.tsx`:**
Add `<ToastProvider />` inside the root Document component, after the main content but inside the body. This makes toast notifications available app-wide.

**Create `packages/frontend/src/components/ErrorBoundary.tsx`:**
Same ErrorFallback component as rwsdk version (no `"use client"` needed — standard React app).

**Create `packages/frontend/src/components/Toast.tsx`:**
Same Toaster wrapper as rwsdk version (no `"use client"` needed).

**Update `packages/frontend/src/main.tsx`:**
Add `<ToastProvider />` inside the root component tree (after QueryClientProvider, inside the React tree).
  </action>
  <verify>
Run `npx tsc --noEmit` in packages/frontend. Verify:
- `ls src/app/components/ErrorBoundary.tsx src/app/components/Toast.tsx`
- `ls packages/frontend/src/components/ErrorBoundary.tsx packages/frontend/src/components/Toast.tsx`
- `grep -n "Toaster\|ToastProvider" src/app/Document.tsx packages/frontend/src/main.tsx`
  </verify>
  <done>
ErrorBoundary and Toast components exist in both apps. Toaster is mounted in both root components. react-error-boundary and sonner are installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire error boundaries into pages and replace all alert/confirm calls</name>
  <files>
    src/app/pages/Profile.tsx
    src/app/pages/Applications.tsx
    src/app/pages/JobDetail.tsx
    packages/frontend/src/pages/admin/AdminPrompts.tsx
    packages/frontend/src/pages/admin/AdminJobs.tsx
    packages/frontend/src/pages/admin/AdminUsers.tsx
    packages/frontend/src/pages/Resume.tsx
    packages/frontend/src/components/WorkExperience.tsx
    packages/frontend/src/components/Education.tsx
  </files>
  <action>
**Error Boundaries (ERR-03) — rwsdk app pages:**

Per user decision: per-section granularity — each major section gets its own boundary so one crash doesn't take out the whole page. Navigation must always remain outside any ErrorBoundary.

In `src/app/pages/Profile.tsx`:
- Wrap the profile Card content in `<ErrorBoundary FallbackComponent={ErrorFallback}>`
- Wrap the Resume Modal content separately in its own `<ErrorBoundary>`

In `src/app/pages/Applications.tsx`:
- Wrap the kanban board / application list content in `<ErrorBoundary>` (not the outer navigation/layout)

In `src/app/pages/JobDetail.tsx`:
- Wrap the job content card in `<ErrorBoundary>`
- Wrap the analysis section separately in `<ErrorBoundary>`

**Replace alert() calls (ERR-04) — rwsdk app:**

Complete inventory from research:
- Profile.tsx line ~104: `alert(error.error || "Failed to parse resume")` → `toast.error(error.error || "Failed to parse resume", { duration: 5000, action: { label: 'Retry', onClick: () => handleResumeUpload() } })`
- Profile.tsx line ~107: `alert("Failed to upload resume")` → `toast.error("Failed to upload resume", { duration: 5000 })`
- Profile.tsx line ~128: `alert("Resume data imported successfully!")` → `toast.success("Resume data imported successfully!")`
- Profile.tsx line ~131: `alert(error.error || "Failed to save resume data")` → `toast.error(error.error || "Failed to save resume data", { duration: 5000 })`
- Profile.tsx line ~134: `alert("Failed to save resume data")` → `toast.error("Failed to save resume data", { duration: 5000 })`

Import `{ toast }` from sonner (or from the local Toast.tsx wrapper).

**Replace confirm() calls — rwsdk app:**

- Applications.tsx line ~39: `confirm("Are you sure you want to delete this application?")` → Replace with inline confirmation state. Add a `confirmingDeleteId` state variable. When delete is clicked, set the ID. Show "Really delete? [Confirm] [Cancel]" inline instead of the delete button. On confirm, execute the delete. On cancel, clear the state.

**Replace alert() calls — packages/frontend:**

- AdminPrompts.tsx lines ~46, 58, 98, 107: Replace 4x `alert()` with `toast.success()` or `toast.error()` as appropriate. Import from `sonner` or local Toast wrapper. Success messages get default 3s duration, errors get 5s.
- AdminJobs.tsx lines ~42, 52, 63: Replace 3x `alert()` with toast notifications.
- AdminUsers.tsx line ~52: Replace `confirm()` with inline confirmation UI (same pattern as Applications.tsx).

**Replace confirm() calls — packages/frontend:**

- Resume.tsx line ~205: Replace `confirm()` with inline confirmation state.
- WorkExperience.tsx line ~238: Replace `confirm()` with inline confirmation state.
- Education.tsx line ~240: Replace `confirm()` with inline confirmation state.

**Toast behavior per user decision:**
- Success: 3 seconds (sonner default or explicit `duration: 3000`)
- Error: 5 seconds (`duration: 5000`)
- Include Retry action button on failure toasts where a retry function is available
- Include Undo action button on destructive action toasts where an undo function is feasible (e.g., delete operations)
- Position: top-right (set on Toaster component in Task 1)

IMPORTANT: Check that NO alert() or confirm() calls remain after changes: `grep -rn "alert(\|confirm(" src/app/ packages/frontend/src/`
  </action>
  <verify>
Run `npx tsc --noEmit` in packages/frontend (and check rwsdk app compiles too if possible). Verify:
- `grep -rn "ErrorBoundary" src/app/pages/ packages/frontend/src/pages/`
- `grep -rn "toast\." src/app/pages/ packages/frontend/src/pages/ packages/frontend/src/components/`
- Confirm zero alert/confirm calls remain: `grep -rn "alert(\|confirm(" src/app/pages/ packages/frontend/src/pages/ packages/frontend/src/components/` should return nothing (or only comments)
  </verify>
  <done>
Error boundaries wrap Profile, Applications, and JobDetail sections — a crash in any section shows the friendly fallback without blanking the entire page. All alert() calls are replaced with toast notifications. All confirm() calls are replaced with inline confirmation UI. Zero blocking browser dialogs remain in the codebase.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in packages/frontend
2. ErrorBoundary wraps content sections in Profile, Applications, JobDetail
3. Zero alert() or confirm() calls remain in src/app/ or packages/frontend/src/
4. Toaster component is mounted in both app roots
5. Toast notifications follow user-specified behavior (top-right, 3s/5s, action buttons)
</verification>

<success_criteria>
- A simulated render error in Profile shows "Oops, something went wrong!" with Retry button, while navigation remains visible
- Uploading a resume that fails shows a toast error notification (not a browser alert)
- Successfully importing resume data shows a toast success notification
- Deleting an application shows inline "Really delete?" confirmation instead of browser confirm() dialog
- No alert() or confirm() calls remain in the frontend code
</success_criteria>

<output>
After completion, create `.planning/phases/03-security-error-handling/03-04-SUMMARY.md`
</output>
