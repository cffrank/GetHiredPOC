---
phase: 02-type-safety-input-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/shared/src/types/resume.ts
  - packages/shared/src/types/job-match.ts
  - packages/shared/src/types/api.ts
  - packages/shared/src/index.ts
  - packages/backend/src/utils/errors.ts
  - packages/backend/src/routes/auth.ts
  - packages/backend/src/routes/applications.ts
  - packages/backend/src/routes/profile.ts
  - packages/backend/src/routes/jobs.ts
  - packages/backend/src/routes/chat.ts
  - packages/backend/src/routes/resumes.ts
  - packages/backend/src/routes/recommendations.ts
  - packages/backend/src/routes/linkedin.ts
  - packages/backend/src/routes/export.ts
  - packages/backend/src/routes/ai-jobs.ts
  - packages/backend/src/routes/admin.ts
  - packages/backend/src/routes/education.ts
  - packages/backend/src/routes/work-experience.ts
  - packages/backend/src/routes/job-preferences.ts
  - packages/backend/src/routes/email-preferences.ts
  - packages/backend/src/services/db.service.ts
  - packages/backend/src/services/resume.service.ts
  - packages/backend/src/services/job-matching.service.ts
  - packages/backend/package.json
autonomous: true
requirements:
  - TYPE-02
  - TYPE-03

must_haves:
  truths:
    - "ParsedResume, JobMatch, and ApplicationUpdate types are importable from @gethiredpoc/shared by both frontend and backend"
    - "No catch block in backend route or service files uses `error: any` — all use `error: unknown` with type narrowing"
    - "zod and @hono/zod-validator are installed in the backend package"
  artifacts:
    - path: "packages/shared/src/types/resume.ts"
      provides: "ParsedResume type definition"
      contains: "export interface ParsedResume"
    - path: "packages/shared/src/types/job-match.ts"
      provides: "JobMatch type definition"
      contains: "export interface JobMatch"
    - path: "packages/shared/src/types/api.ts"
      provides: "ApplicationUpdate type definition"
      contains: "export interface ApplicationUpdate"
    - path: "packages/shared/src/index.ts"
      provides: "Barrel exports for new types"
      contains: "ParsedResume"
    - path: "packages/backend/src/utils/errors.ts"
      provides: "toMessage helper for unknown errors"
      exports: ["toMessage"]
  key_links:
    - from: "packages/shared/src/index.ts"
      to: "packages/shared/src/types/resume.ts"
      via: "re-export"
      pattern: "export.*from.*types/resume"
    - from: "packages/shared/src/index.ts"
      to: "packages/shared/src/types/job-match.ts"
      via: "re-export"
      pattern: "export.*from.*types/job-match"
    - from: "packages/backend/src/routes/*.ts"
      to: "packages/backend/src/utils/errors.ts"
      via: "import toMessage"
      pattern: "import.*toMessage.*from.*utils/errors"
---

<objective>
Create shared TypeScript types for ParsedResume, JobMatch, and ApplicationUpdate, install Zod dependencies, and replace all `catch (error: any)` blocks with typed error handling across the backend.

Purpose: TYPE-02 requires these three types in the shared package so both frontend and backend import from a single source of truth. TYPE-03 requires eliminating `catch (error: any)` — the 77 occurrences across backend files — with `catch (error: unknown)` and a `toMessage` helper. Installing zod and @hono/zod-validator now unblocks Plan 02.

Output: Three new shared type files, barrel exports updated, toMessage utility created, all catch blocks migrated, zod dependencies installed.
</objective>

<execution_context>
@/home/carl/.claude/get-shit-done/workflows/execute-plan.md
@/home/carl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-type-safety-input-validation/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared types and install Zod dependencies</name>
  <files>
    packages/shared/src/types/resume.ts
    packages/shared/src/types/job-match.ts
    packages/shared/src/types/api.ts
    packages/shared/src/index.ts
    packages/backend/package.json
  </files>
  <action>
1. Create `packages/shared/src/types/resume.ts` with the `ParsedResume` interface. Copy the shape from `packages/backend/src/services/resume.service.ts` where it is currently defined as a local type. The interface should include: fullName?, email?, phone?, location?, summary?, workExperience array (company, title, location?, startDate?, endDate?, description?), education array (school, degree?, fieldOfStudy?, startDate?, endDate?, gpa?), skills string array optional.

2. Create `packages/shared/src/types/job-match.ts` with the `JobMatch` interface. Copy the shape from `packages/backend/src/services/job-matching.service.ts`. The interface should include: jobId: string, score: number (0-100), strengths: string[], concerns: string[], recommendation: 'strong' | 'good' | 'fair' | 'weak'.

3. Add `ApplicationUpdate` interface to the existing `packages/shared/src/types/api.ts` file. Fields: status?: string, notes?: string, ai_match_score?: number, ai_analysis?: string. Check if `UpdateApplicationRequest` already exists in that file — if so, verify it covers the same fields and add `ApplicationUpdate` as an alias or separate interface as needed.

4. Update `packages/shared/src/index.ts` barrel file to re-export the new types:
   - `export type { ParsedResume } from './types/resume'`
   - `export type { JobMatch } from './types/job-match'`
   - `export type { ApplicationUpdate } from './types/api'` (add to existing api re-exports)

5. Install zod and @hono/zod-validator in the backend workspace:
   ```bash
   npm install zod@^3 @hono/zod-validator --workspace=packages/backend
   ```

IMPORTANT: Do NOT use zod v4 — the @hono/zod-validator 0.7.6 release was built against zod v3. Stick with v3.
  </action>
  <verify>
Run from project root:
- `cd packages/shared && npx tsc --noEmit` — compiles with no errors
- `grep -r "ParsedResume" packages/shared/src/index.ts` — shows the export
- `grep -r "JobMatch" packages/shared/src/index.ts` — shows the export
- `grep -r "ApplicationUpdate" packages/shared/src/index.ts` — shows the export
- `grep "zod" packages/backend/package.json` — shows zod and @hono/zod-validator in dependencies
  </verify>
  <done>ParsedResume, JobMatch, and ApplicationUpdate are exported from @gethiredpoc/shared. zod@^3 and @hono/zod-validator are in backend dependencies.</done>
</task>

<task type="auto">
  <name>Task 2: Replace all catch (error: any) with typed error handling</name>
  <files>
    packages/backend/src/utils/errors.ts
    packages/backend/src/routes/auth.ts
    packages/backend/src/routes/applications.ts
    packages/backend/src/routes/profile.ts
    packages/backend/src/routes/jobs.ts
    packages/backend/src/routes/chat.ts
    packages/backend/src/routes/resumes.ts
    packages/backend/src/routes/recommendations.ts
    packages/backend/src/routes/linkedin.ts
    packages/backend/src/routes/export.ts
    packages/backend/src/routes/ai-jobs.ts
    packages/backend/src/routes/admin.ts
    packages/backend/src/routes/education.ts
    packages/backend/src/routes/work-experience.ts
    packages/backend/src/routes/job-preferences.ts
    packages/backend/src/routes/email-preferences.ts
    packages/backend/src/services/db.service.ts
    packages/backend/src/services/resume.service.ts
    packages/backend/src/services/job-matching.service.ts
  </files>
  <action>
1. Create `packages/backend/src/utils/errors.ts` with a `toMessage` helper:
   ```typescript
   export function toMessage(error: unknown): string {
     if (error instanceof Error) return error.message
     if (typeof error === 'string') return error
     return 'An unexpected error occurred'
   }
   ```

2. In every backend route file and service file, replace ALL instances of `catch (error: any)` with `catch (error: unknown)`. There are ~77 occurrences across the backend. For each:
   - Change `catch (error: any)` → `catch (error: unknown)`
   - If the catch block accesses `error.message`, replace with `toMessage(error)`
   - Add `import { toMessage } from '../utils/errors'` at the top of each file that needs it
   - If the catch block accesses other error properties (e.g., `error.status`, `error.code`), wrap with `if (error instanceof Error)` narrowing

   **Batch-checkpoint strategy (process in groups, compile-check between):**
   - **Batch A — Route files:** Process all files in `packages/backend/src/routes/` (auth, applications, profile, jobs, chat, resumes, recommendations, linkedin, export, ai-jobs, admin, education, work-experience, job-preferences, email-preferences). After completing all route files, run `cd packages/backend && npx tsc --noEmit` to verify compilation. Fix any errors before proceeding.
   - **Batch B — Service files:** Process all files in `packages/backend/src/services/` (db.service, resume.service, job-matching.service, and any others with catch blocks like ai-resume.service, ai-cover-letter.service, chat.service). After completing all service files, run `cd packages/backend && npx tsc --noEmit` again. Fix any errors.

   This prevents a compilation error in one batch from leaving the other batch in an unknown state.

3. Search for any remaining `: any` annotations specifically in catch blocks. Also check service files like `ai-resume.service.ts`, `ai-cover-letter.service.ts`, `chat.service.ts`, etc. — the research found 77 total occurrences across all backend files, not just route files.

4. After all replacements, run `grep -rn "catch (error: any)" packages/backend/src/` to confirm zero remaining instances.

IMPORTANT: Do NOT change function parameter `any` types in this task — that is Plan 02's scope (TYPE-01). Only change catch blocks (TYPE-03).
  </action>
  <verify>
- `grep -rn "catch (error: any)" packages/backend/src/` returns zero results
- `grep -rn "catch (error: unknown)" packages/backend/src/` returns ~77 results (all migrated)
- `cd packages/backend && npx tsc --noEmit` — compiles with no errors
- `npm test --workspace=packages/backend` — existing tests still pass
  </verify>
  <done>Zero `catch (error: any)` blocks remain in backend. All catch blocks use `error: unknown` with toMessage() helper or instanceof narrowing. TypeScript compiles cleanly.</done>
</task>

</tasks>

<verification>
1. `grep -rn "catch (error: any)" packages/backend/src/` → zero matches
2. `grep -rn "ParsedResume\|JobMatch\|ApplicationUpdate" packages/shared/src/index.ts` → all three types exported
3. `cd packages/shared && npx tsc --noEmit` → no errors
4. `cd packages/backend && npx tsc --noEmit` → no errors
5. `npm test --workspace=packages/backend` → tests pass
6. `grep "zod" packages/backend/package.json` → both packages present
</verification>

<success_criteria>
- ParsedResume, JobMatch, ApplicationUpdate importable from @gethiredpoc/shared
- Zero `catch (error: any)` in entire backend codebase
- toMessage utility exists and is imported where needed
- zod@^3 and @hono/zod-validator installed in backend
- TypeScript compiles with no errors in both shared and backend packages
</success_criteria>

<output>
After completion, create `.planning/phases/02-type-safety-input-validation/02-01-SUMMARY.md`
</output>
