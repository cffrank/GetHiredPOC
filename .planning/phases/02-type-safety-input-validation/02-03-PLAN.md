---
phase: 02-type-safety-input-validation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/backend/src/services/job-matching.service.ts
  - packages/backend/src/services/resume.service.ts
  - packages/frontend/src/pages/Recommendations.tsx
autonomous: true
gap_closure: true
requirements:
  - TYPE-01
  - TYPE-02
  - TYPE-03
  - VALID-01
  - VALID-02
  - VALID-03

must_haves:
  truths:
    - "job-matching.service.ts imports JobMatch from @gethiredpoc/shared instead of defining its own local interface"
    - "resume.service.ts imports ParsedResume from @gethiredpoc/shared instead of defining its own local interface"
    - "Recommendations.tsx imports JobMatch from @gethiredpoc/shared and uses it within a composed response type instead of defining its own local interface"
    - "TypeScript compiles without regressions after the import migrations"
  artifacts:
    - path: "packages/backend/src/services/job-matching.service.ts"
      provides: "JobMatch imported from shared, no local definition"
      contains: "import type { JobMatch } from '@gethiredpoc/shared'"
    - path: "packages/backend/src/services/resume.service.ts"
      provides: "ParsedResume imported from shared, no local definition"
      contains: "import type { ParsedResume } from '@gethiredpoc/shared'"
    - path: "packages/frontend/src/pages/Recommendations.tsx"
      provides: "JobMatch imported from shared, local wrapper type uses it"
      contains: "import type { JobMatch } from '@gethiredpoc/shared'"
  key_links:
    - from: "packages/backend/src/services/job-matching.service.ts"
      to: "packages/shared/src/types/job-match.ts"
      via: "import type { JobMatch } from '@gethiredpoc/shared'"
      pattern: "import type \\{ JobMatch \\} from '@gethiredpoc/shared'"
    - from: "packages/backend/src/services/resume.service.ts"
      to: "packages/shared/src/types/resume.ts"
      via: "import type { ParsedResume } from '@gethiredpoc/shared'"
      pattern: "import type \\{ ParsedResume \\} from '@gethiredpoc/shared'"
    - from: "packages/frontend/src/pages/Recommendations.tsx"
      to: "packages/shared/src/types/job-match.ts"
      via: "import type { JobMatch } from '@gethiredpoc/shared'"
      pattern: "import type \\{ JobMatch \\} from '@gethiredpoc/shared'"
---

<objective>
Close the single verification gap from Phase 2: three files still define local duplicate interfaces (JobMatch, ParsedResume) instead of importing from @gethiredpoc/shared. This blocks success criterion 2 ("types imported by both backend services and frontend code").

Purpose: Eliminate dual sources of truth — the shared package types must be the canonical definitions consumed by all backend services and frontend components.
Output: Three files migrated from local interface definitions to shared package imports.
</objective>

<execution_context>
@/home/carl/.claude/get-shit-done/workflows/execute-plan.md
@/home/carl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-type-safety-input-validation/02-VERIFICATION.md
@.planning/phases/02-type-safety-input-validation/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate backend services to shared type imports</name>
  <files>
    packages/backend/src/services/job-matching.service.ts
    packages/backend/src/services/resume.service.ts
  </files>
  <action>
    In `packages/backend/src/services/job-matching.service.ts`:
    1. Remove the local `export interface JobMatch { ... }` definition (lines 4-10)
    2. Add `import type { JobMatch } from '@gethiredpoc/shared';` at the top (after the existing Env import)
    3. Keep the `export` on the function — the file still exports `analyzeJobMatch` which returns `Promise<JobMatch>`. Other files importing `JobMatch` from this service file will need to switch to importing from `@gethiredpoc/shared` instead. Check: `grep -rn "from.*job-matching.service" packages/` to find any consumers importing JobMatch from this file and update them to import from `@gethiredpoc/shared`.
    4. Re-export JobMatch so existing consumers don't break: add `export type { JobMatch } from '@gethiredpoc/shared';` if any consumers import JobMatch from this service file. If no consumers import JobMatch from this file, skip the re-export.

    In `packages/backend/src/services/resume.service.ts`:
    1. Remove the local `export interface ParsedResume { ... }` definition (lines 3-24)
    2. Add `import type { ParsedResume } from '@gethiredpoc/shared';` at the top (after the existing Env import)
    3. Same consumer check: `grep -rn "from.*resume.service" packages/` to find any files importing ParsedResume from this service. If found, either update them to import from `@gethiredpoc/shared` or add a re-export.

    IMPORTANT: The shared types in `@gethiredpoc/shared` are identical to the local definitions (they were copied from these files in plan 02-01). The interfaces match field-for-field, so this is a pure import swap with zero behavior change.

    After changes, run: `cd packages/backend && npx tsc --noEmit 2>&1 | head -50` to confirm no NEW TypeScript errors introduced (pre-existing errors in chat.service.ts etc. are expected and acceptable).
  </action>
  <verify>
    1. `grep -n "export interface JobMatch" packages/backend/src/services/job-matching.service.ts` returns empty (no local definition)
    2. `grep -n "export interface ParsedResume" packages/backend/src/services/resume.service.ts` returns empty (no local definition)
    3. `grep -n "from '@gethiredpoc/shared'" packages/backend/src/services/job-matching.service.ts` returns the import line
    4. `grep -n "from '@gethiredpoc/shared'" packages/backend/src/services/resume.service.ts` returns the import line
    5. `cd packages/backend && npx tsc --noEmit 2>&1 | grep -c "error TS"` — count must not exceed pre-existing error count (27 errors from 02-02 baseline)
  </verify>
  <done>
    job-matching.service.ts and resume.service.ts import JobMatch and ParsedResume from @gethiredpoc/shared. No local duplicate interface definitions remain. TypeScript compiles with no new errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate frontend Recommendations to shared JobMatch import</name>
  <files>
    packages/frontend/src/pages/Recommendations.tsx
  </files>
  <action>
    In `packages/frontend/src/pages/Recommendations.tsx`:

    The local `interface JobMatch` (lines 8-26) is NOT identical to the shared `JobMatch`. The local definition is a wrapper: `{ match: { jobId, score, strengths, concerns, recommendation }, job: { id, title, company, ... } }`. The shared `JobMatch` is just the inner match part: `{ jobId, score, strengths, concerns, recommendation }`.

    1. Add `import type { JobMatch } from '@gethiredpoc/shared';` after the existing imports (line 6)
    2. Replace the local `interface JobMatch` with a new interface that composes the shared type:
       ```typescript
       interface JobRecommendation {
         match: JobMatch;
         job: {
           id: string;
           title: string;
           company: string;
           location: string;
           remote: number;
           salary_min: number;
           salary_max: number;
           description: string;
         };
       }
       ```
    3. Update all usages of `JobMatch` as the response type in this file to use `JobRecommendation` instead:
       - `useState<JobMatch[]>([])` → `useState<JobRecommendation[]>([])`
       - Any other references to the local `JobMatch` type used as the API response wrapper

    Note: The `recommendation` field in the shared `JobMatch` is typed as `'strong' | 'good' | 'fair' | 'weak'` (union literal), while the local definition used `string`. The shared type is stricter, which is correct. If TypeScript raises an issue with the badge color mapping function, the literal union will actually improve type safety there.

    After changes, verify the frontend compiles: `cd packages/frontend && npx tsc --noEmit 2>&1 | head -30`
  </action>
  <verify>
    1. `grep -n "interface JobMatch" packages/frontend/src/pages/Recommendations.tsx` returns empty (no local JobMatch definition — only JobRecommendation should exist)
    2. `grep -n "from '@gethiredpoc/shared'" packages/frontend/src/pages/Recommendations.tsx` returns the import line
    3. `grep -n "JobRecommendation" packages/frontend/src/pages/Recommendations.tsx` returns at least the interface definition and useState usage
    4. `cd packages/frontend && npx tsc --noEmit 2>&1 | head -30` — no new errors introduced
  </verify>
  <done>
    Recommendations.tsx imports JobMatch from @gethiredpoc/shared and uses it within a composed JobRecommendation response type. No local duplicate of the shared JobMatch interface remains. Frontend TypeScript compiles with no new errors.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **No local duplicates remain:**
   - `grep -rn "export interface JobMatch" packages/backend/src/services/` returns empty
   - `grep -rn "export interface ParsedResume" packages/backend/src/services/` returns empty
   - `grep -rn "^interface JobMatch" packages/frontend/src/pages/` returns empty

2. **Shared imports wired:**
   - `grep -rn "from '@gethiredpoc/shared'" packages/backend/src/services/job-matching.service.ts` shows JobMatch import
   - `grep -rn "from '@gethiredpoc/shared'" packages/backend/src/services/resume.service.ts` shows ParsedResume import
   - `grep -rn "from '@gethiredpoc/shared'" packages/frontend/src/pages/Recommendations.tsx` shows JobMatch import

3. **TypeScript compiles cleanly (no new errors):**
   - Backend: `cd packages/backend && npx tsc --noEmit` — error count <= 27 (pre-existing baseline)
   - Frontend: `cd packages/frontend && npx tsc --noEmit` — no new errors

4. **Backend test still passes:**
   - `npm test --workspace=packages/backend` — 1 test passes
</verification>

<success_criteria>
- ParsedResume, JobMatch, and ApplicationUpdate types from @gethiredpoc/shared are imported by both backend services and frontend code (success criterion 2 fully satisfied)
- Zero local duplicate interface definitions for these three types remain in service files or frontend components
- TypeScript compiles with no regressions in either workspace
- All 4/4 phase 2 success criteria now pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-type-safety-input-validation/02-03-SUMMARY.md`
</output>
