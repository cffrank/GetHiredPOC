---
phase: 03-security-error-handling
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/components/ErrorBoundary.tsx
  - src/app/components/Toast.tsx
  - src/app/Document.tsx
  - src/app/pages/Profile.tsx
  - src/app/pages/Applications.tsx
  - src/app/pages/JobDetail.tsx
autonomous: true
requirements:
  - ERR-03
  - ERR-04

must_haves:
  truths:
    - "When a component in Profile, Applications, or JobDetail crashes, the rest of the page continues to render and the user sees a friendly error message with a Retry button"
    - "All alert() calls in the rwsdk app pages are replaced with toast notifications"
    - "All confirm() calls in the rwsdk app pages are replaced with inline confirmation UI"
    - "Success toasts appear top-right for 3 seconds, error toasts for 5 seconds"
  artifacts:
    - path: "src/app/components/ErrorBoundary.tsx"
      provides: "Reusable error boundary wrapper for rwsdk app"
      exports: ["ErrorFallback"]
    - path: "src/app/components/Toast.tsx"
      provides: "Toast provider wrapper for rwsdk app"
  key_links:
    - from: "src/app/pages/Profile.tsx"
      to: "src/app/components/ErrorBoundary.tsx"
      via: "ErrorBoundary wraps profile content sections"
      pattern: "ErrorBoundary"
    - from: "src/app/pages/Profile.tsx"
      to: "sonner"
      via: "toast.success/toast.error replace alert() calls"
      pattern: "toast\\.(success|error)"
    - from: "src/app/Document.tsx"
      to: "sonner"
      via: "Toaster component rendered in root document"
      pattern: "Toaster"
---

<objective>
Add React error boundaries and toast notifications to the rwsdk app — create shared ErrorBoundary and Toast components, wire error boundaries into page sections, and replace all alert()/confirm() calls.

Purpose: Close ERR-03 (error boundaries per UI domain) and ERR-04 (user-friendly error notifications) for the rwsdk app. Currently, an unhandled render error blanks the entire page, and all error/success feedback uses blocking browser alert() dialogs.

Output: Per-section error boundaries in Profile, Applications, and JobDetail with friendly fallback UI. Toast notifications (sonner) for all success/error feedback in the rwsdk app. Inline confirmation UI replacing confirm() dialogs.
</objective>

<execution_context>
@/home/carl/.claude/get-shit-done/workflows/execute-plan.md
@/home/carl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-security-error-handling/03-RESEARCH.md

@src/app/pages/Profile.tsx
@src/app/pages/Applications.tsx
@src/app/pages/JobDetail.tsx
@src/app/Document.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install libraries, create ErrorBoundary and Toast components for rwsdk app</name>
  <files>
    src/app/components/ErrorBoundary.tsx
    src/app/components/Toast.tsx
    src/app/Document.tsx
  </files>
  <action>
**Install dependencies:**
```bash
npm install react-error-boundary sonner
```

**Create `src/app/components/ErrorBoundary.tsx` (rwsdk app):**

Use react-error-boundary library. Create an `ErrorFallback` component per user decision:
- Simple message + retry button, no illustrations
- Friendly casual tone: "Oops, something went wrong! Let's try that again."
- Console-only error logging (no external reporting)
- Styled with Tailwind: centered text, muted colors, rounded border, padding

```tsx
import { ErrorBoundary } from 'react-error-boundary';
import type { FallbackProps } from 'react-error-boundary';

export function ErrorFallback({ error, resetErrorBoundary }: FallbackProps) {
  console.error('[ErrorBoundary]', error);
  return (
    <div className="p-6 rounded-lg border border-gray-200 text-center">
      <p className="text-gray-600 mb-4">
        Oops, something went wrong! Let&apos;s try that again.
      </p>
      <button
        onClick={resetErrorBoundary}
        className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
      >
        Retry
      </button>
    </div>
  );
}

export { ErrorBoundary };
```

Add `"use client"` directive at the top if required by rwsdk's RSC model (research Open Question 4).

**Create `src/app/components/Toast.tsx` (rwsdk app):**

Wrap sonner's Toaster with the user-specified settings. Add `"use client"` directive for RSC compatibility.

```tsx
"use client";
import { Toaster } from 'sonner';

export function ToastProvider() {
  return <Toaster position="top-right" richColors />;
}

export { toast } from 'sonner';
```

**Update `src/app/Document.tsx`:**
Add `<ToastProvider />` inside the root Document component, after the main content but inside the body. This makes toast notifications available app-wide.
  </action>
  <verify>
Verify:
- `ls src/app/components/ErrorBoundary.tsx src/app/components/Toast.tsx`
- `grep -n "Toaster\|ToastProvider" src/app/Document.tsx`
  </verify>
  <done>
ErrorBoundary and Toast components exist in the rwsdk app. Toaster is mounted in the root Document. react-error-boundary and sonner are installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire error boundaries into rwsdk pages and replace alert/confirm calls</name>
  <files>
    src/app/pages/Profile.tsx
    src/app/pages/Applications.tsx
    src/app/pages/JobDetail.tsx
  </files>
  <action>
**Error Boundaries (ERR-03) — rwsdk app pages:**

Per user decision: per-section granularity — each major section gets its own boundary so one crash doesn't take out the whole page. Navigation must always remain outside any ErrorBoundary.

In `src/app/pages/Profile.tsx`:
- Wrap the profile Card content in `<ErrorBoundary FallbackComponent={ErrorFallback}>`
- Wrap the Resume Modal content separately in its own `<ErrorBoundary>`

In `src/app/pages/Applications.tsx`:
- Wrap the kanban board / application list content in `<ErrorBoundary>` (not the outer navigation/layout)

In `src/app/pages/JobDetail.tsx`:
- Wrap the job content card in `<ErrorBoundary>`
- Wrap the analysis section separately in `<ErrorBoundary>`

**Replace alert() calls (ERR-04) — rwsdk app:**

Complete inventory from research:
- Profile.tsx line ~104: `alert(error.error || "Failed to parse resume")` -> `toast.error(error.error || "Failed to parse resume", { duration: 5000, action: { label: 'Retry', onClick: () => handleResumeUpload() } })`
- Profile.tsx line ~107: `alert("Failed to upload resume")` -> `toast.error("Failed to upload resume", { duration: 5000 })`
- Profile.tsx line ~128: `alert("Resume data imported successfully!")` -> `toast.success("Resume data imported successfully!")`
- Profile.tsx line ~131: `alert(error.error || "Failed to save resume data")` -> `toast.error(error.error || "Failed to save resume data", { duration: 5000 })`
- Profile.tsx line ~134: `alert("Failed to save resume data")` -> `toast.error("Failed to save resume data", { duration: 5000 })`

Import `{ toast }` from sonner (or from the local Toast.tsx wrapper).

**Replace confirm() calls — rwsdk app:**

- Applications.tsx line ~39: `confirm("Are you sure you want to delete this application?")` -> Replace with inline confirmation state. Add a `confirmingDeleteId` state variable. When delete is clicked, set the ID. Show "Really delete? [Confirm] [Cancel]" inline instead of the delete button. On confirm, execute the delete. On cancel, clear the state.

**Toast behavior per user decision:**
- Success: 3 seconds (sonner default or explicit `duration: 3000`)
- Error: 5 seconds (`duration: 5000`)
- Include Retry action button on failure toasts where a retry function is available
- Include Undo action button on destructive action toasts where an undo function is feasible (e.g., delete operations)
- Position: top-right (set on Toaster component in Task 1)

IMPORTANT: Check that NO alert() or confirm() calls remain in rwsdk app after changes: `grep -rn "alert(\|confirm(" src/app/`
  </action>
  <verify>
Verify:
- `grep -rn "ErrorBoundary" src/app/pages/`
- `grep -rn "toast\." src/app/pages/`
- Confirm zero alert/confirm calls remain in rwsdk app: `grep -rn "alert(\|confirm(" src/app/pages/` should return nothing (or only comments)
  </verify>
  <done>
Error boundaries wrap Profile, Applications, and JobDetail sections. All alert() calls in rwsdk app pages are replaced with toast notifications. All confirm() calls are replaced with inline confirmation UI. Zero blocking browser dialogs remain in the rwsdk app.
  </done>
</task>

</tasks>

<verification>
1. ErrorBoundary wraps content sections in Profile, Applications, JobDetail
2. Zero alert() or confirm() calls remain in src/app/
3. Toaster component is mounted in the rwsdk app root Document
4. Toast notifications follow user-specified behavior (top-right, 3s/5s, action buttons)
</verification>

<success_criteria>
- A simulated render error in Profile shows "Oops, something went wrong!" with Retry button, while navigation remains visible
- Uploading a resume that fails shows a toast error notification (not a browser alert)
- Successfully importing resume data shows a toast success notification
- Deleting an application shows inline "Really delete?" confirmation instead of browser confirm() dialog
- No alert() or confirm() calls remain in the rwsdk app code
</success_criteria>

<output>
After completion, create `.planning/phases/03-security-error-handling/03-04-SUMMARY.md`
</output>
