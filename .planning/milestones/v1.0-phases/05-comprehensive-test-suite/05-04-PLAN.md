---
phase: 05-comprehensive-test-suite
plan: 04
type: execute
wave: 2
depends_on:
  - 05-01
  - 05-02
  - 05-03
files_modified:
  - playwright.config.ts
  - e2e/signup-to-apply.spec.ts
  - package.json
autonomous: true
requirements:
  - TEST-05

must_haves:
  truths:
    - "Running npx playwright test executes the signup -> profile setup -> job search -> apply flow end-to-end"
    - "The E2E test creates a new account, fills profile info, navigates to jobs, and completes the apply action"
    - "The test runs against real frontend dev server and backend API server"
  artifacts:
    - path: "playwright.config.ts"
      provides: "Playwright configuration with webServer entries for frontend and backend"
      contains: "webServer"
    - path: "e2e/signup-to-apply.spec.ts"
      provides: "E2E test for signup-to-apply flow"
      contains: "signup"
  key_links:
    - from: "playwright.config.ts"
      to: "packages/frontend dev server"
      via: "webServer command starting Vite on port 5173"
      pattern: "localhost:5173"
    - from: "e2e/signup-to-apply.spec.ts"
      to: "packages/frontend/src/pages"
      via: "browser navigation to page URLs"
      pattern: "page\\.goto"
---

<objective>
Set up Playwright and create an E2E test for the signup-to-apply user flow.

Purpose: Satisfy TEST-05 — E2E tests covering signup -> profile setup -> job search -> apply flow running against the full stack.
Output: Playwright config at workspace root and one E2E spec file covering the critical user journey.
</objective>

<execution_context>
@/home/carl/.claude/get-shit-done/workflows/execute-plan.md
@/home/carl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-comprehensive-test-suite/05-RESEARCH.md

@package.json
@packages/frontend/src/pages/Signup.tsx
@packages/frontend/src/pages/Profile.tsx
@packages/frontend/src/pages/Jobs.tsx
@packages/frontend/src/pages/JobDetail.tsx
@packages/frontend/src/pages/Applications.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Playwright and create config</name>
  <files>
    package.json
    playwright.config.ts
  </files>
  <action>
    **Step 1: Install Playwright** at the workspace root:
    ```bash
    npm install -D @playwright/test
    npx playwright install chromium
    ```

    **Step 2: Create `playwright.config.ts`** at the workspace root:
    - Set `testDir: './e2e'`
    - Set `fullyParallel: false` (tests share DB state via sequential flow)
    - Set `retries: process.env.CI ? 2 : 0`
    - Set `reporter: 'html'`
    - Set `use.baseURL: 'http://localhost:5173'`
    - Set `use.trace: 'on-first-retry'`
    - Set `use.screenshot: 'only-on-failure'`
    - Single project: chromium only (Desktop Chrome device)
    - Use two `webServer` entries (Playwright supports array):
      1. Frontend: `command: 'npm run dev:frontend'`, `url: 'http://localhost:5173'`, `reuseExistingServer: !process.env.CI`
      2. Backend: `command: 'npm run dev:backend'`, `url: 'http://localhost:8787'`, `reuseExistingServer: !process.env.CI`
    - Set reasonable `timeout: 30000` for each test

    **Step 3: Add E2E script** to root `package.json`:
    Add `"test:e2e": "npx playwright test"` to the scripts section.

    **NOTE:** The webServer entries will start both dev servers automatically when running E2E tests. `reuseExistingServer: !process.env.CI` means locally it reuses already-running servers; in CI it starts fresh ones.
  </action>
  <verify>
    Run `npx playwright test --list` from workspace root — shows available test files (may be empty if e2e/ dir doesn't exist yet, that's OK).
    Verify `playwright.config.ts` exists at workspace root.
  </verify>
  <done>Playwright installed with chromium browser, config created with dual webServer entries for frontend and backend dev servers.</done>
</task>

<task type="auto">
  <name>Task 2: Create signup-to-apply E2E test</name>
  <files>
    e2e/signup-to-apply.spec.ts
  </files>
  <action>
    **First:** Read the frontend page components to understand exact URL paths, form labels, button text, and page flow:
    - Read `packages/frontend/src/pages/Signup.tsx` — identify form fields (email, password), submit button text, redirect after signup
    - Read `packages/frontend/src/pages/Profile.tsx` — identify edit button, form fields (full_name), save button
    - Read `packages/frontend/src/pages/Jobs.tsx` — identify how job listings are rendered, link patterns to job detail
    - Read `packages/frontend/src/pages/JobDetail.tsx` — identify apply button text and behavior
    - Read `packages/frontend/src/pages/Applications.tsx` — identify how to verify an application was created
    - Also read the router/App file to confirm URL paths (`/signup`, `/profile`, `/jobs`, `/jobs/:id`, `/applications`)

    **Create `e2e/signup-to-apply.spec.ts`:**

    ```typescript
    import { test, expect } from '@playwright/test';

    test('signup -> profile setup -> job search -> apply', async ({ page }) => {
      const email = `e2e-${Date.now()}@example.com`;

      // Step 1: Signup
      await page.goto('/signup');
      // Fill email and password fields — use getByLabel or getByPlaceholder based on actual markup
      // Click create account / signup button
      // Wait for redirect to profile or dashboard

      // Step 2: Profile setup
      // Navigate to /profile if not already there
      // Click edit button
      // Fill full name field
      // Click save
      // Verify name appears on page

      // Step 3: Job search
      await page.goto('/jobs');
      // Wait for job listings to load
      // Verify at least one job appears (or handle empty state)

      // Step 4: Click a job and apply
      // Click first job link
      // Wait for job detail page
      // Click apply/save button
      // Verify redirect to applications or success indicator
    });
    ```

    **CRITICAL considerations:**
    - Use unique email with `Date.now()` to avoid duplicate signup errors
    - Use Playwright's auto-wait: `page.getByRole()`, `page.getByLabel()`, `page.getByText()` — these auto-wait for elements
    - The test depends on the backend having at least one job in the database. If running against a fresh local D1, the jobs table may be empty. Handle this: either the test checks for empty state gracefully, OR add a comment noting that E2E requires seeded data.
    - Use `expect(page).toHaveURL(...)` for navigation assertions
    - Use `await expect(locator).toBeVisible()` for content assertions
    - If the flow can't fully complete (e.g., no jobs in dev DB), document which steps pass and which are conditional on data availability
    - Set generous timeouts for page loads since dev servers compile on-demand
  </action>
  <verify>
    If dev servers are running (or can be started): run `npx playwright test` — test completes.
    If dev servers can't be started in this context: run `npx playwright test --list` to verify the test file is recognized.
    Verify `e2e/signup-to-apply.spec.ts` exists with the full flow.
  </verify>
  <done>E2E test covers signup with unique email, profile name setup, navigation to jobs listing, job detail view, and apply action. Test uses Playwright auto-wait locators and runs against real dev servers.</done>
</task>

</tasks>

<verification>
Run `npx playwright test --list` — shows `signup-to-apply.spec.ts`.
If possible: `npx playwright test` — full E2E flow completes against running dev servers.
</verification>

<success_criteria>
- `playwright.config.ts` exists at workspace root with dual webServer config
- `e2e/signup-to-apply.spec.ts` covers signup -> profile -> job search -> apply flow
- `@playwright/test` installed as devDependency
- Root package.json has `test:e2e` script
</success_criteria>

<output>
After completion, create `.planning/phases/05-comprehensive-test-suite/05-04-SUMMARY.md`
</output>
